<h1>
    {{ "PLUGIN_USERS.USERS"|tu }}
</h1>
<form>
    <div class="users_search">
        <input type="text" placeholder="{{ "PLUGIN_ADMIN.RESOURCE_FILTER"|tu }}" data-users-filter>
    </div>
</form>

<div class="users card-row grid fixed-blocks pure-g">
	{% for user in users.getAll()|ksort %}
		
		<div class="user card-item pure-u-1-3" data-username="{{ user.username }}" data-fullname="{{ user.fullname }}">
			<div class="user_name">
				<i class="fa fa-fw fa-user"></i>
				<a href="{{ base_url_relative }}/user/{{ user.username }}">{{ user.fullname }}</a>
				<span class="gpm-version">{{ user.username }}</span>
			</div>
			<div class="user_avatar">
				{% if user.avatar %}
					{% set avatar = base_url_simple ~ '/' ~ (user.avatar|first).path %}
				{% else %}
					{% set avatar = 'https://www.gravatar.com/avatar/' ~ user.email|md5 ~ '?s=200' %}
				{% endif %}
                <a href="{{ base_url_relative }}/user/{{ user.username }}"><img src="{{avatar}}" /></a>
            </div>
		</div>
		
	{% endfor %}
</div>

<script>
	function debounce(callback, delay) {
		var timeout;
		return function() {
			var context = this
			var args = arguments;
			clearTimeout(timeout);
			timeout = setTimeout(function() {
				callback.apply(context, args);
			}, delay);
		};
	};
	
	function contains(str, substring, fromIndex){
        return str.indexOf(substring, fromIndex) !== -1;
    }
	
	$(document).on('input', '[data-users-filter]', debounce((event) => {
		let value = $($(event.currentTarget)).val();
		let items = $('div.user');
		
		items.hide().filter((index, item) => {
			item = $(item);
			return contains(item.data('fullname').toLowerCase(), value.toLowerCase()) || contains(item.data('username').toLowerCase(), value.toLowerCase());
		}).show();
	}, 250));
</script>